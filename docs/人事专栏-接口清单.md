# 人事专栏 & 基础设施 接口清单

> 基础路径：`/admin-api`（前端需配置 VITE_APP_BASE_API 或等效环境变量）  
> 所有接口需登录，请求头携带 `Authorization: Bearer {token}`  
> 分页接口统一使用 `PageParam` 继承字段：`pageNo`、`pageSize`

---

## 一、考勤模块

### 1.1 排班规则 `/system/attendance-rule`

| 方法 | 路径 | 说明 | 权限 |
|------|------|------|------|
| POST | `/admin-api/system/attendance-rule/create` | 创建排班规则 | `system:attendance-rule:update` |
| PUT | `/admin-api/system/attendance-rule/update` | 修改排班规则 | `system:attendance-rule:update` |
| DELETE | `/admin-api/system/attendance-rule/delete?id={id}` | 删除排班规则 | `system:attendance-rule:update` |
| GET | `/admin-api/system/attendance-rule/get?id={id}` | 获取排班规则详情 | `system:attendance-rule:query` |
| GET | `/admin-api/system/attendance-rule/page` | 排班规则分页列表 | `system:attendance-rule:query` |
| GET | `/admin-api/system/attendance-rule/list-enabled` | 获取所有启用的排班规则（下拉选项） | `system:attendance-rule:query` |

**create/update 请求体**：`AttendanceRuleSaveReqVO`  
- name, shiftType(1早班2晚班), workDaysPerWeek(5/6), workStartTime, workEndTime, lateThresholdMinutes, earlyLeaveThresholdMinutes, isFollowHoliday, status, remark

---

### 1.2 法定节假日 `/system/holiday`

| 方法 | 路径 | 说明 | 权限 |
|------|------|------|------|
| POST | `/admin-api/system/holiday/create` | 创建节假日 | `system:holiday:update` |
| PUT | `/admin-api/system/holiday/update` | 修改节假日 | `system:holiday:update` |
| DELETE | `/admin-api/system/holiday/delete?id={id}` | 删除节假日 | `system:holiday:update` |
| GET | `/admin-api/system/holiday/get?id={id}` | 获取节假日详情 | `system:holiday:query` |
| GET | `/admin-api/system/holiday/page` | 节假日分页列表 | `system:holiday:query` |

**分页参数**：pageNo, pageSize, year, type(1休息2调班), name  
**create/update 请求体**：name, holidayDate, type, year, remark

---

### 1.3 考勤排班 `/system/attendance-schedule`

| 方法 | 路径 | 说明 | 权限 |
|------|------|------|------|
| GET | `/admin-api/system/attendance-schedule/page` | 排班分页列表 | `system:attendance-schedule:query` |
| POST | `/admin-api/system/attendance-schedule/generate?yearMonth={202603}` | 手动生成排班（yearMonth 可选，缺省则生成下月） | `system:attendance-schedule:update` |
| PUT | `/admin-api/system/attendance-schedule/change-shift` | 临时调班 | `system:attendance-schedule:update` |
| GET | `/admin-api/system/attendance-schedule/my-monthly-summary?yearMonth={202603}` | 个人中心-本月考勤汇总 | 登录即可 |
| GET | `/admin-api/system/attendance-schedule/my-monthly?yearMonth={202603}` | 个人中心-本月每日排班 | 登录即可 |

**分页参数**：pageNo, pageSize, userId, yearMonth, shiftType  
**change-shift 请求体**：`{ "id": 排班ID, "ruleId": 规则ID }`

---

### 1.4 打卡记录 `/system/attendance-record`

| 方法 | 路径 | 说明 | 权限 |
|------|------|------|------|
| GET | `/admin-api/system/attendance-record/page` | 打卡记录分页列表 | `system:attendance-schedule:query` |
| POST | `/admin-api/system/attendance-record/clock-in` | 签到 | `system:attendance-record:clock` |
| POST | `/admin-api/system/attendance-record/clock-out` | 签退 | `system:attendance-record:clock` |

**分页参数**：pageNo, pageSize, userId, status(0正常1迟到2早退3缺勤), beginDate, endDate

---

## 二、花名册模块 `/system/hr-employee`

| 方法 | 路径 | 说明 | 权限 |
|------|------|------|------|
| POST | `/admin-api/system/hr-employee/create` | 创建员工花名册 | `system:hr-employee:update` |
| PUT | `/admin-api/system/hr-employee/update` | 修改员工花名册 | `system:hr-employee:update` |
| DELETE | `/admin-api/system/hr-employee/delete?id={id}` | 删除员工花名册记录 | `system:hr-employee:update` |
| GET | `/admin-api/system/hr-employee/get?id={id}` | 获取员工花名册详情 | `system:hr-employee:query` |
| GET | `/admin-api/system/hr-employee/page` | 员工花名册分页列表 | `system:hr-employee:query` |
| GET | `/admin-api/system/hr-employee/export-excel` | 导出员工花名册 Excel | `system:hr-employee:export` |
| GET | `/admin-api/system/hr-employee/my-profile` | 个人中心-我的员工档案 | 登录即可 |

**分页参数**：pageNo, pageSize, nickname, deptId, employmentType, employmentStatus  
**create/update 请求体**：userId, nickname, deptId, postId, mobile, email, sex, employmentType, employmentStatus, defaultRuleId, joinDate, formalDate, leaveDate, idCard, emergencyContact, emergencyPhone, remark

---

## 三、薪资模块 `/system/salary`

### 3.1 薪资配置

| 方法 | 路径 | 说明 | 权限 |
|------|------|------|------|
| GET | `/admin-api/system/salary/config/get` | 获取薪资配置 | `system:salary-config:query` |
| POST | `/admin-api/system/salary/config/save` | 保存薪资配置 | `system:salary-config:update` |

### 3.2 员工薪资档案

| 方法 | 路径 | 说明 | 权限 |
|------|------|------|------|
| POST | `/admin-api/system/salary/employee/create` | 创建员工薪资档案 | `system:employee-salary:update` |
| PUT | `/admin-api/system/salary/employee/update` | 修改员工薪资档案 | `system:employee-salary:update` |
| GET | `/admin-api/system/salary/employee/page` | 员工薪资档案分页列表 | `system:employee-salary:query` |

**分页参数**：pageNo, pageSize, userId  
**create/update 请求体**：userId, baseSalary, positionSalary, allowance, effectiveDate, remark

### 3.3 月度薪资

| 方法 | 路径 | 说明 | 权限 |
|------|------|------|------|
| GET | `/admin-api/system/salary/monthly/page` | 月度薪资分页列表 | `system:salary-monthly:query` |
| POST | `/admin-api/system/salary/monthly/generate?yearMonth={202603}` | 发起月结算（生成草稿） | `system:salary-monthly:update` |
| PUT | `/admin-api/system/salary/monthly/update` | 编辑薪资单（填写绩效/提成） | `system:salary-monthly:update` |
| PUT | `/admin-api/system/salary/monthly/confirm?id={id}` | 确认薪资单 | `system:salary-monthly:update` |
| PUT | `/admin-api/system/salary/monthly/batch-confirm?ids={id1,id2}` | 批量确认薪资单 | `system:salary-monthly:update` |
| GET | `/admin-api/system/salary/monthly/export-excel` | 导出月度薪资 Excel | `system:salary-monthly:export` |
| GET | `/admin-api/system/salary/my-latest` | 个人中心-最新薪资单 | 登录即可 |
| GET | `/admin-api/system/salary/my-list` | 个人中心-历史薪资列表 | 登录即可 |

**分页参数**：pageNo, pageSize, userId, yearMonth, status(0待确认1已确认2已发放)  
**monthly/update 请求体**：`{ "id": 主键, "performance": 绩效, "commission": 提成, "remark": 备注 }`

---

## 四、在线文档 `/infra/doc`

### 4.1 文档分类

| 方法 | 路径 | 说明 | 权限 |
|------|------|------|------|
| POST | `/admin-api/infra/doc/category/create` | 创建文档分类 | `infra:doc:update` |
| PUT | `/admin-api/infra/doc/category/update` | 修改文档分类 | `infra:doc:update` |
| DELETE | `/admin-api/infra/doc/category/delete?id={id}` | 删除文档分类 | `infra:doc:update` |
| GET | `/admin-api/infra/doc/category/tree` | 获取文档分类树 | `infra:doc:query` |

### 4.2 文档

| 方法 | 路径 | 说明 | 权限 |
|------|------|------|------|
| POST | `/admin-api/infra/doc/create` | 创建文档 | `infra:doc:update` |
| PUT | `/admin-api/infra/doc/update` | 修改文档 | `infra:doc:update` |
| DELETE | `/admin-api/infra/doc/delete?id={id}` | 删除文档 | `infra:doc:update` |
| GET | `/admin-api/infra/doc/get?id={id}` | 获取文档详情（会+1 浏览次数） | `infra:doc:query` |
| GET | `/admin-api/infra/doc/page` | 文档分页列表 | `infra:doc:query` |

**分页参数**：pageNo, pageSize, categoryId, type(1上传预览2外部链接3下载), status, name  
**create/update 请求体**：categoryId, name, type, fileUrl, fileType, externalUrl, fileSize, sort, status, remark

---

## 五、合同管理 `/infra/contract`

| 方法 | 路径 | 说明 | 权限 |
|------|------|------|------|
| POST | `/admin-api/infra/contract/create` | 创建合同 | `infra:contract:update` |
| PUT | `/admin-api/infra/contract/update` | 修改合同 | `infra:contract:update` |
| DELETE | `/admin-api/infra/contract/delete?id={id}` | 删除合同 | `infra:contract:update` |
| GET | `/admin-api/infra/contract/get?id={id}` | 获取合同详情 | `infra:contract:query` |
| GET | `/admin-api/infra/contract/page` | 合同分页列表 | `infra:contract:query` |
| GET | `/admin-api/infra/contract/export-excel` | 导出合同 Excel | `infra:contract:export` |
| GET | `/admin-api/infra/contract/my-list` | 个人中心-我负责的合同列表 | 登录即可 |

**分页参数**：pageNo, pageSize, contractName, type(1销售2采购3劳动4其他), status, responsibleUserId  

**create 请求体**（InfraContractSaveReqVO）：
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| contractNo | string | 否 | 合同编号，不填则后端自动生成（HT+yyyyMMddHHmmss） |
| contractName | string | 是 | 合同名称 |
| type | int | 是 | 1=销售 2=采购 3=劳动 4=其他 |
| customerName | string | 否 | 客户/乙方名称 |
| amount | decimal | 否 | 合同金额（元） |
| signDate | string | 否 | 签订日期，格式 yyyy-MM-dd |
| startDate | string | 否 | 开始日期，格式 yyyy-MM-dd |
| endDate | string | 否 | 结束日期，格式 yyyy-MM-dd |
| responsibleUserId | long | 否 | 负责人用户ID，后端会据此查询并写入 responsibleUsername 快照 |
| fileUrl | string | 否 | 合同附件URL（通过 infra/file/upload 上传） |
| commissionRate | decimal | 否 | 提成比例（如 0.05=5%），后端自动计算 commissionAmount |
| commissionStartDate | string | 否 | 提成归属开始日期，为空时取 startDate |
| commissionEndDate | string | 否 | 提成归属结束日期，为空时取 endDate |
| commissionYearMonth | int | 否 | 提成归属年月（保留兼容，0=按签订日期） |
| status | int | 否 | 0=草稿 1=生效 2=已完成 3=已终止 |
| remark | string | 否 | 备注 |

**update 请求体**：同上，需额外传 `id`（主键）

**create 响应**：返回完整合同对象 InfraContractRespVO（含 contract_no、responsible_username 等），前端可直接展示

**get / page 响应**（InfraContractRespVO）：
| 字段 | 类型 | 说明 |
|------|------|------|
| id | long | 主键 |
| contractNo | string | 合同编号（创建时自动生成） |
| contractName | string | 合同名称 |
| type | int | 合同类型 |
| customerName | string | 客户名称 |
| amount | decimal | 合同金额 |
| signDate | string | 签订日期 yyyy-MM-dd |
| startDate | string | 开始日期 yyyy-MM-dd |
| endDate | string | 结束日期 yyyy-MM-dd |
| responsibleUserId | long | 负责人用户ID |
| responsibleUsername | string | 负责人姓名快照（后端根据 responsibleUserId 自动填充） |
| fileUrl | string | 合同附件URL |
| commissionRate | decimal | 提成比例 |
| commissionAmount | decimal | 提成金额（后端自动计算） |
| commissionStartDate | string | 提成归属开始日期 |
| commissionEndDate | string | 提成归属结束日期 |
| commissionYearMonth | int | 提成归属年月（兼容） |
| status | int | 合同状态 |
| remark | string | 备注 |
| createTime | string | 创建时间 |

**日期字段说明**：signDate、startDate、endDate、commissionStartDate、commissionEndDate 均为 `yyyy-MM-dd` 格式。若编辑后再次打开不显示，请检查前端是否正确绑定响应数据到表单。

---

## 六、通用说明

### 6.1 分页参数（PageParam）

所有 `page` 接口均支持：
- `pageNo`：页码，从 1 开始
- `pageSize`：每页条数

### 6.2 统一响应格式

```json
{
  "code": 0,
  "data": { ... },
  "msg": "success"
}
```

### 6.3 导出接口

`export-excel` 接口为文件流下载，需设置 `responseType: 'blob'`，请求参数与对应 `page` 接口一致。

### 6.4 个人中心接口

- `/my-profile`、`/my-monthly-summary`、`/my-monthly`、`/my-latest`、`/my-list`、`/my-list`（合同）  
- 仅需登录，无需额外权限，返回当前登录用户的数据。

---

## 六、个人中心聚合面板 `/system/personal-center`

> 所有接口只需登录，无额外权限要求，**前端首页工作台 / 个人中心页面的核心接口**。

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/admin-api/system/personal-center/panel?yearMonth={202603}` | 聚合面板：一次返回员工档案 + 本月考勤汇总 + 今日打卡状态 + 最新薪资单 + 薪资公式 + 我的合同 |
| POST | `/admin-api/system/personal-center/clock-in` | 快捷签到（首页打卡快捷入口） |
| POST | `/admin-api/system/personal-center/clock-out` | 快捷签退（首页打卡快捷入口） |

**`panel` 接口响应结构**（`PersonalCenterPanelVO`）：

```json
{
  "code": 0,
  "data": {
    "currentYearMonth": 202603,
    "todayClockIn": true,
    "todayClockOut": false,
    "employee": {
      "id": 1, "nickname": "张三", "deptName": "销售部", "postName": "销售专员",
      "employmentStatus": 1, "joinDate": "2024-03-01", "idCard": "411***199001016543"
    },
    "attendance": {
      "shouldAttendDays": 21, "actualAttendDays": 19,
      "lateCount": 1, "absentCount": 1,
      "dailyList": [
        { "date": "2026-03-01", "status": 0 },
        { "date": "2026-03-02", "status": -1 }
      ]
    },
    "latestSalary": {
      "yearMonth": 202602, "totalSalary": 8200.00,
      "baseSalary": 5000, "positionSalary": 1500,
      "performance": 800, "commission": 600,
      "allowance": 100, "fullAttendanceBonus": 200,
      "status": 1
    },
    "salaryConfig": {
      "enableBaseSalary": true, "enablePositionSalary": true,
      "enablePerformance": true, "enableCommission": true,
      "enableAllowance": true, "enableFullAttendance": true,
      "fullAttendanceAmount": 200.00
    },
    "contracts": [
      {
        "id": 1, "contractName": "XX公司服务合同",
        "amount": 100000, "commissionAmount": 5000,
        "status": 1, "endDate": "2026-12-31"
      }
    ]
  }
}
```

**每日考勤状态说明（`dailyList[].status`）**：

| 值 | 含义 | 前端建议颜色 |
|----|------|------------|
| -1 | 休息日（无需打卡） | 灰色 |
| 0 | 正常出勤 | 绿色 |
| 1 | 迟到 | 黄色 |
| 2 | 早退 | 橙色 |
| 3 | 缺勤/未打卡 | 红色 |

---

## 七、接口汇总（按模块）

| 模块 | 接口数量 | 基础路径 |
|------|----------|----------|
| 排班规则 | 6 | `/admin-api/system/attendance-rule` |
| 法定节假日 | 5 | `/admin-api/system/holiday` |
| 考勤排班 | 5 | `/admin-api/system/attendance-schedule` |
| 打卡记录 | 3 | `/admin-api/system/attendance-record` |
| 花名册 | 7 | `/admin-api/system/hr-employee` |
| 薪资 | 12 | `/admin-api/system/salary` |
| 在线文档 | 9 | `/admin-api/infra/doc` |
| 合同管理 | 7 | `/admin-api/infra/contract` |
| **个人中心聚合面板** | **3** | `/admin-api/system/personal-center` |
| **合计** | **57** | - |
